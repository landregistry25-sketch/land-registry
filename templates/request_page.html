<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Property Requests</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --primary: #d6001c;
      --primary-dark: #ad0015;
      --bg: #f6f1f5;
      --card: #fff;
      --muted: #787486;
      --radius: 16px;
      --shadow-1: 0 8px 24px rgba(214,0,28,0.09);
      --maxw: 920px;
    }

    body {
      margin: 0;
      font-family: "Inter", Arial, sans-serif;
       background:linear-gradient(135deg,#f3f6fc 0%,#eef2fb 100%);
    }

    .navbar {
      width: 100%;
      background: #fff;
      box-shadow: var(--shadow-1);
      display: flex;
      align-items: center;
      padding: 0 0 0 0;
      border-bottom: 2.5px solid var(--primary);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .back-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--primary);
      color: #fff;
      border-radius: 10px;
      width: 44px;
      height: 44px;
      margin: 15px 0 15px 35px;
      font-size: 22px;
      cursor: pointer;
      border: none;
      transition: background 0.2s;
      box-shadow: 0 2px 10px rgba(214,0,28,0.12);
      text-decoration: none;
    }
    .back-btn:hover {
      background: var(--primary-dark);
    }
    .navbar-title {
      font-size: 21px;
      font-weight: 700;
      color: var(--primary);
      margin-left: 22px;
      letter-spacing: 1px;
    }

    .container {
      max-width: var(--maxw);
      margin: 40px auto 0;
      background: #fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow-1);
      padding: 0 0 38px 0;
    }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 38px;
      border-bottom: 3px solid #f5c0cb;
      margin-bottom: 18px;
      margin-top: 0;
      padding-top: 24px;
      background: #fff;
      border-radius: var(--radius) var(--radius) 0 0;
    }
    .tab {
      background: none;
      border: none;
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
      letter-spacing: 0.2px;
      padding: 12px 0 16px 0;
      cursor: pointer;
      position: relative;
      transition: color 0.2s;
    }
    .tab.active {
      color: var(--primary-dark);
      border-bottom: 3px solid var(--primary);
    }

    .card-list {
      margin: 32px 0 0 0;
      display: flex;
      flex-direction: column;
      gap: 22px;
      padding: 0 30px;
    }
    .request-card {
      background: #fff;
      padding: 26px 32px;
      border-radius: var(--radius);
      display: flex;
      gap: 38px;
      align-items: center;
      box-shadow: var(--shadow-1);
      border: 2px solid #f9e1e7;
    }
    .avatar {
      width: 66px;
      height: 66px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
      background: #fce7ec;
      box-shadow: 0 3px 13px #edd0d7;
      border: 1.5px solid #ffd1d3;
    }
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .meta { flex: 1; }
    .name {
      font-size: 18px;
      font-weight: 800;
      color: var(--primary-dark);
      margin-bottom: 2px;
    }
    .row {
      color: var(--muted);
      font-size: 15px;
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 3px;
    }
    .badge {
      margin-top: 7px;
      padding: 7px 14px;
      border-radius: 9px;
      color: #fff;
      font-size: 14px;
      font-weight: 700;
      background: var(--primary);
      display: inline-block;
      letter-spacing: 0.2px;
      box-shadow: 0 2px 8px rgba(214,0,28,0.09);
    }
    .badge.approved { background: #28a745; }
    .badge.rejected { background: #999; }

    .actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-width: 120px;
    }
    .btn {
      padding: 10px 21px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      font-size: 15px;
      letter-spacing: 0.2px;
      display: flex;
      align-items: center;
      gap: 9px;
      justify-content: center;
      transition: background 0.16s;
      box-shadow: 0 2px 9px rgba(214,0,28,0.12);
    }
    .btn.view { background: var(--primary); color: #fff; }
    .btn.delete { background: #333; color: #fff; }
    .btn.approve { background: #28a745; color: #fff; }
    .btn.reject, .btn.cancel { background: var(--primary-dark); color: #fff; }
    .btn:hover { opacity: 0.93; }

    .empty {
      text-align: center;
      color: var(--muted);
      padding: 55px 11px;
      background: #fff5f7;
      border-radius: var(--radius);
      border: 1.5px dashed #e2b7be;
      font-size: 19px;
      margin-top: 12px;
      box-shadow: 0 2px 14px #ffdbe6;
    }

    /* MODAL */
    #viewModal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(214,0,28,0.19);
      z-index: 999;
      justify-content: center;
      align-items: center;
      overflow: auto;
    }
    #viewModal .modal-content {
      background: #fff;
      padding: 28px 25px;
      border-radius: 16px;
      max-width: 330px;
      width: 98%;
      margin: auto;
      box-shadow: var(--shadow-1);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #viewModal img {
      width: 80px; height: 80px; border-radius: 50%; margin-bottom: 16px; border:2px solid var(--primary);
      object-fit: cover;
    }
    #viewModal h2 {
      color: var(--primary-dark);
      margin-bottom: 18px;
      font-size: 22px;
      font-weight: 800;
    }
    #viewModal .mrow {
      margin-bottom: 10px;
      font-size: 15px;
      color: #23243a;
      width: 100%;
      text-align: left;
    }
    #viewModal button {
      background: var(--primary);
      color: #fff;
      font-size: 15px;
      font-weight: 700;
      border: none;
      border-radius: 9px;
      padding: 8px 24px;
      margin-top: 10px;
      cursor: pointer;
      transition: background 0.17s;
    }
    #viewModal button:hover { background: var(--primary-dark); }

    @media (max-width: 900px) {
      .container { border-radius: 0; box-shadow: none; }
      .request-card { flex-direction: column; align-items: stretch; gap: 16px; padding: 20px 10px; }
      .actions { min-width: 0; flex-direction: row; gap: 10px; justify-content: flex-end;}
    }
    @media (max-width: 600px) {
      .card-list { padding: 0 6px;}
      .navbar-title { font-size: 16px; }
      .request-card { font-size: 14px; }
      .tab { font-size: 15px;}
    }
  </style>
</head>
<body>
  <!-- NAVBAR -->
  <div class="navbar">
    <a class="back-btn" href="{{ url_for('shome') }}" title="Back">
      <i class="fa-solid fa-arrow-left"></i>
    </a>
    <span class="navbar-title">Property Requests</span>
  </div>

  <div class="container">
    <!-- TABS -->
    <div class="tabs">
      <button class="tab active" id="tab-received" onclick="showTab('received')">Buy Requests Received</button>
      <button class="tab" id="tab-sent" onclick="showTab('sent')">Buy Requests Sent</button>
    </div>

    <!-- RECEIVED SECTION -->
    <div id="received">
      {% if received_requests %}
        <div class="card-list">
          {% for r in received_requests %}
          <div class="request-card">
            <div class="avatar">
              <img src="{{ url_for('uploaded_file', filename=r.buyer_photo) if r.buyer_photo else url_for('static', filename='default_user.png') }}" alt="Buyer Photo">
            </div>
            <div class="meta">
              <div class="name">{{ r.buyer_name }}</div>
              <div class="row">
                <span><i class="fa fa-location-dot"></i> {{ r.property_location }}</span>
                <span><i class="fa fa-indian-rupee-sign"></i> {{ r.price }} • {{ r.property_type }}</span>
                <span><i class="fa fa-calendar"></i> {{ r.requested_at }}</span>
              </div>
              <span class="badge {% if r.status == 'approved' %}approved{% elif r.status == 'rejected' %}rejected{% endif %}">{{ r.status|capitalize }}</span>
            </div>
            <div class="actions">
              <button class="btn view"
                onclick='showDetails({
                  name: "{{ r.buyer_name }}",
                  email: "{{ r.buyer_email }}",
                  phone: "{{ r.buyer_phone }}",
                  location: "{{ r.property_location }}",
                  type: "{{ r.property_type }}",
                  price: "{{ r.price }}",
                  photo: "{{ url_for("uploaded_file", filename=r.buyer_photo) if r.buyer_photo else url_for("static", filename="default_user.png") }}"
                })'>
                <i class="fa fa-eye"></i> View
              </button>
              <a href="/delete_request/{{ r.id }}" class="btn delete">
                <i class="fa fa-trash"></i> Delete
              </a>
              {% if r.status == 'pending' %}
                <form action="/approve_request/{{ r.id }}" method="POST" style="margin:0;">
                  <button class="btn approve" type="submit">
                    <i class="fa fa-check"></i> Approve
                  </button>
                </form>
                <form action="/reject_transfer_request/{{ r.id }}" method="POST" style="margin:0;">
                  <button class="btn reject" type="submit">
                    <i class="fa fa-xmark"></i> Reject
                  </button>
                </form>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty">No buy requests received.</div>
      {% endif %}
    </div>

    <!-- SENT SECTION -->
    <div id="sent" style="display:none;">
      {% if sent_requests %}
        <div class="card-list">
          {% for r in sent_requests %}
          <div class="request-card">
            <div class="avatar">
              <img src="{{ url_for('uploaded_file', filename=r.seller_photo) if r.seller_photo else url_for('static', filename='default_user.png') }}" alt="Seller Photo">
            </div>
            <div class="meta">
              <div class="name">{{ r.seller_name }}</div>
              <div class="row">
                <span><i class="fa fa-location-dot"></i> {{ r.property_location }}</span>
                <span><i class="fa fa-indian-rupee-sign"></i> {{ r.price }} • {{ r.property_type }}</span>
                <span><i class="fa fa-calendar"></i> {{ r.requested_at }}</span>
              </div>
              <span class="badge {% if r.status == 'approved' %}approved{% elif r.status == 'rejected' %}rejected{% endif %}">{{ r.status|capitalize }}</span>
            </div>
            <div class="actions">
              <button class="btn view"
                onclick='showDetails({
                  name: "{{ r.seller_name }}",
                  email: "{{ r.seller_email }}",
                  phone: "{{ r.seller_phone }}",
                  location: "{{ r.property_location }}",
                  type: "{{ r.property_type }}",
                  price: "{{ r.price }}",
                  photo: "{{ url_for("uploaded_file", filename=r.seller_photo) if r.seller_photo else url_for("static", filename="default_user.png") }}"
                })'>
                <i class="fa fa-eye"></i> View
              </button>
              <a class="btn delete" href="/delete_request/{{ r.id }}">
                <i class="fa fa-trash"></i> Delete
              </a>
              {% if r.status == 'pending' %}
                <a class="btn cancel" href="/cancel_request/{{ r.id }}">Cancel</a>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty">No requests sent.</div>
      {% endif %}
    </div>

    <!-- VIEW MODAL -->
    <div id="viewModal">
      <div class="modal-content">
        <img id="modalPhoto" src="" alt="Photo">
        <h2>Request Details</h2>
        <div class="mrow"><b>Name:</b> <span id="modalName"></span></div>
        <div class="mrow"><b>Email:</b> <span id="modalEmail"></span></div>
        <div class="mrow"><b>Phone:</b> <span id="modalPhone"></span></div>
        <div class="mrow"><b>Location:</b> <span id="modalLocation"></span></div>
        <div class="mrow"><b>Type:</b> <span id="modalType"></span></div>
        <div class="mrow"><b>Price:</b> <span id="modalPrice"></span></div>
        <button onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>
  <script>
    function showTab(tab) {
      document.getElementById('received').style.display = tab === 'received' ? '' : 'none';
      document.getElementById('sent').style.display = tab === 'sent' ? '' : 'none';
      document.getElementById('tab-received').classList.toggle('active', tab === 'received');
      document.getElementById('tab-sent').classList.toggle('active', tab === 'sent');
    }
    function showDetails(data) {
      document.getElementById('modalPhoto').src = data.photo;
      document.getElementById('modalName').textContent = data.name || '--';
      document.getElementById('modalEmail').textContent = data.email || '--';
      document.getElementById('modalPhone').textContent = data.phone || '--';
      document.getElementById('modalLocation').textContent = data.location || '--';
      document.getElementById('modalType').textContent = data.type || '--';
      document.getElementById('modalPrice').textContent = data.price || '--';
      document.getElementById('viewModal').style.display = "flex";
    }
    function closeModal() {
      document.getElementById('viewModal').style.display = "none";
    }
  </script>
</body>
</html>
